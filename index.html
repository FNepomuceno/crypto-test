<!doctype html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
<script src="key.js"></script>
<script src="store.js"></script>
<script src="encrypt.js"></script>
<script>
(async function () {
  console.log('generating rsa key pair')
  let {
    privateKey: aPrivate,
    publicKey: aPublic
  } = await generateRsaKeypair()
  console.log('finished generating rsa key pair')

  let data = window.crypto.getRandomValues(new Uint8Array(16))
  let encrypted = await encryptRsa(aPublic, data)
  let decrypted = await decryptRsa(aPrivate, encrypted)

  let dataHex = bufferToHex(data)
  let encryptedHex = bufferToHex(encrypted)
  let decryptedHex = bufferToHex(decrypted)

  console.log(dataHex, encryptedHex, decryptedHex)
  console.log(dataHex === decryptedHex)

  function bufferToHex(buffer) {
    let data = Array.from(new Uint8Array(buffer))
    return data.map(x => x.toString(16).padStart(2, '0')).join('')
  }
})()
</script>
</body>
</html>
